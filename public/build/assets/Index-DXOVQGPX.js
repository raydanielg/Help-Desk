import{i as j,Z as N,k as A,r as _,c as n,a as d,b as t,f as F,G as U,t as o,w as u,g as b,h as m,F as h,j as y,o as i,n as k,e as f}from"./app-a1pcr069.js";import{I as B,h as L}from"./moment-BbZOc2s_.js";import{S as T,t as P,p as D}from"./SearchInput-Btdhsrxv.js";import{L as O}from"./Layout-CCj0oP25.js";import{m as z}from"./mapValues-BTwQdjL6.js";import{P as E}from"./Pagination-CmEu2SMB.js";import{S as H}from"./SelectInput-LDo5GZlZ.js";import{S as K}from"./SelectInputFilter-fntCZT8t.js";import{_ as R}from"./FlashMessages-CFOcLP80.js";import"./v4-SoommWqA.js";const G={metaInfo:{title:"Tickets"},components:{SearchInput:T,Icon:B,Link:j,Head:N,Pagination:E,SelectInputFilter:K,SelectInput:H},layout:O,props:{filters:Object,tickets:Object,assignees:Array,auth:Object,title:String,priorities:Array,statuses:Array,types:Array,categories:Array,departments:Array,hidden_fields:Object},remember:"form",data(){return{headers:[{name:"Key",value:"id",sort:!0},{name:"Subject",value:"subject",sort:!0},{name:"Priority",value:"priority_id",sort:!0},{name:"Status",value:"status_id",sort:!0},{name:"Date",value:"created_at",sort:!0},{name:"Updated",value:"updated_at",sort:!0}],user_access:this.$page.props.auth.user.access,form:{search:this.filters.search,limit:this.filters.limit??10,customer_id:this.filters.customer_id,field:this.filters.field,direction:this.filters.direction,priority_id:this.filters.priority_id??null,status_id:this.filters.status_id??null,type_id:this.filters.type_id??null,category_id:this.filters.category_id??null,department_id:this.filters.department_id??null}}},watch:{form:{deep:!0,handler:P(function(){this.$inertia.get(this.route("tickets"),D(this.form),{replace:!0,preserveState:!0})},150)}},methods:{doFilter(s){A.get(this.route("filter.assignees",{search:s.target.value})).then(r=>{this.assignees.splice(0,this.assignees.length,...r.data)})},sort(s){this.form.field=s,this.form.direction=this.form.direction==="asc"?"desc":"asc"},reset(){this.form=z(this.form,()=>null)},uploadImportCSV(s){s.target.files.length&&this.$inertia.form({file:s.target.files[0]}).post(this.route("ticket.csv.import"))}},created(){this.moment=L}},M={class:"flex flex-col md:flex-row gap-3 mb-4 justify-between items-center ticket-filters"},Z={class:"flex flex-col md:flex-row gap-2"},q={for:"importCSV",class:"uppercase gap-[1px] cursor-pointer text-sm px-3 py-1 flex items-center justify-center"},J={class:"uppercase gap-[1px] cursor-pointer text-sm px-3 py-1 flex items-center justify-center",href:"/dashboard/ticket/csv/export"},Q={class:"filter-add-new flex flex-col gap-3 md:flex-row items-center"},W={class:"flex flex-col gap-3 mb-4 md:flex-row w-full items-center ticket-filters"},X={class:"mr-2 w-full"},Y={value:null},$=["value"],ee={value:null},te=["value"],se={value:null},re=["value"],le={value:null},oe=["value"],ie={value:null},ne=["value"],ae={class:"bg-white rounded-md shadow overflow-x-auto"},de={class:"min-w-full whitespace-nowrap ticket_list"},ue={class:"text-left font-bold"},me={key:0,class:"icons"},fe={class:"border-t"},ce={class:"border-t"},pe={class:"subject_t"},_e={class:"user__d flex text-xs items-center pt-1"},he={key:0,class:"user__n flex items-center pr-4",title:"Client"},ye={key:1,class:"user__n flex items-center pr-4",title:"Assignee"},ge={class:"border-t"},ve={class:"border-t"},be={class:"border-t"},ke={class:"border-t"},we={key:0},xe={class:"border-t px-6 py-4",colspan:"9"};function Ve(s,r,a,Se,l,c){const w=_("Head"),x=_("search-input"),p=_("Link"),g=_("select-input"),V=_("select-input-filter"),v=_("icon"),S=_("pagination");return i(),n("div",null,[d(w,{title:s.$t(a.title)},null,8,["title"]),t("div",M,[t("div",Z,[F(t("select",{"onUpdate:modelValue":r[0]||(r[0]=e=>l.form.limit=e),class:"w-16 bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg block px-2 py-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:focus:ring-blue-500 dark:focus:border-blue-500"},r[9]||(r[9]=[t("option",{value:"10"},"10",-1),t("option",{value:"25"},"25",-1),t("option",{value:"50"},"50",-1),t("option",{value:"100"},"100",-1)]),512),[[U,l.form.limit]]),t("label",q,[r[10]||(r[10]=t("img",{class:"w-6 h-6",src:"/images/svg/import-csv.svg",alt:"Import CSV"},null,-1)),t("span",null,o(s.$t("Import")),1),t("input",{onChange:r[1]||(r[1]=(...e)=>c.uploadImportCSV&&c.uploadImportCSV(...e)),class:"hidden",id:"importCSV",type:"file"},null,32)]),t("a",J,[r[11]||(r[11]=t("img",{class:"w-6 h-6",src:"/images/svg/export-csv.svg",alt:"Export CSV"},null,-1)),t("span",null,o(s.$t("Export")),1)])]),t("div",Q,[d(x,{modelValue:l.form.search,"onUpdate:modelValue":r[2]||(r[2]=e=>l.form.search=e),placeholder:"Search by Key, Subject, Priority, Status, Assign to...",class:"w-full max-w-md search",onReset:c.reset},null,8,["modelValue","onReset"]),d(p,{class:"btn-indigo",href:this.route("tickets.create")},{default:u(()=>[t("span",null,o(s.$t("New Ticket")),1)]),_:1},8,["href"])])]),t("div",W,[t("div",X,o(s.$t("Filter Ticket By"))+":",1),a.hidden_fields&&a.hidden_fields.includes("ticket_type")?m("",!0):(i(),b(g,{key:0,modelValue:l.form.type_id,"onUpdate:modelValue":r[3]||(r[3]=e=>l.form.type_id=e),class:"mr-2 w-full"},{default:u(()=>[t("option",Y,o(s.$t("Type")),1),(i(!0),n(h,null,y(a.types,e=>(i(),n("option",{key:e.id,value:e.id},o(e.name),9,$))),128))]),_:1},8,["modelValue"])),a.hidden_fields&&a.hidden_fields.includes("category")?m("",!0):(i(),b(g,{key:1,modelValue:l.form.category_id,"onUpdate:modelValue":r[4]||(r[4]=e=>l.form.category_id=e),class:"mr-2 w-full"},{default:u(()=>[t("option",ee,o(s.$t("Category")),1),(i(!0),n(h,null,y(a.categories,e=>(i(),n("option",{key:e.id,value:e.id},o(e.name),9,te))),128))]),_:1},8,["modelValue"])),a.hidden_fields&&a.hidden_fields.includes("department")?m("",!0):(i(),b(g,{key:2,modelValue:l.form.department_id,"onUpdate:modelValue":r[5]||(r[5]=e=>l.form.department_id=e),class:"mr-2 w-full"},{default:u(()=>[t("option",se,o(s.$t("Department")),1),(i(!0),n(h,null,y(a.departments,e=>(i(),n("option",{key:e.id,value:e.id},o(e.name),9,re))),128))]),_:1},8,["modelValue"])),d(g,{modelValue:l.form.priority_id,"onUpdate:modelValue":r[6]||(r[6]=e=>l.form.priority_id=e),class:"mr-2 w-full"},{default:u(()=>[t("option",le,o(s.$t("Priority")),1),(i(!0),n(h,null,y(a.priorities,e=>(i(),n("option",{key:e.id,value:e.id},o(e.name),9,oe))),128))]),_:1},8,["modelValue"]),d(g,{modelValue:l.form.status_id,"onUpdate:modelValue":r[7]||(r[7]=e=>l.form.status_id=e),class:"mr-2 w-full"},{default:u(()=>[t("option",ie,o(s.$t("Status")),1),(i(!0),n(h,null,y(a.statuses,e=>(i(),n("option",{key:e.id,value:e.id},o(e.name),9,ne))),128))]),_:1},8,["modelValue"]),!(a.hidden_fields&&a.hidden_fields.includes("assigned_to"))&&l.user_access.ticket.update?(i(),b(V,{key:3,placeholder:s.$t("Assign To"),onInput:c.doFilter,onFocus:c.doFilter,items:a.assignees,modelValue:l.form.assigned_to,"onUpdate:modelValue":r[8]||(r[8]=e=>l.form.assigned_to=e),class:"w-full"},null,8,["placeholder","onInput","onFocus","items","modelValue"])):m("",!0)]),t("div",ae,[t("table",de,[t("tbody",null,[t("tr",ue,[(i(!0),n(h,null,y(l.headers,(e,C)=>(i(),n("th",{key:C},[t("span",{class:k({sort:e.sort,active:l.form.field===e.name},l.form.direction)},[f(o(s.$t(e.name))+" ",1),e.sort?(i(),n("span",me,[d(v,{class:k(["fill-gray-300",{"fill-gray-800":l.form.direction==="desc"&&l.form.field===e.value}]),name:"up",onClick:I=>c.sort(e.value)},null,8,["class","onClick"]),d(v,{class:k(["fill-gray-300",{"fill-gray-800":l.form.direction==="asc"&&l.form.field===e.value}]),name:"down",onClick:I=>c.sort(e.value)},null,8,["class","onClick"])])):m("",!0)],2)]))),128))]),(i(!0),n(h,null,y(a.tickets.data,e=>(i(),n("tr",{key:e.id,class:"hover:bg-gray-100 focus-within:bg-gray-100"},[t("td",fe,[d(p,{class:"flex items-center px-6 py-4 focus:text-indigo-500",href:s.route("tickets.edit",e.uid||e.id)},{default:u(()=>[f(" #"+o(e.uid),1)]),_:2},1032,["href"])]),t("td",ce,[d(p,{class:"s__details flex flex-col",href:s.route("tickets.edit",e.uid||e.id)},{default:u(()=>[t("span",pe,o(e.subject),1),t("span",_e,[e.user?(i(),n("span",he,[d(v,{name:"user",class:"flex-shrink-0 h-3 fill-gray-400 pr-1"}),f(" "+o(e.user),1)])):m("",!0),e.assigned_to?(i(),n("span",ye,[d(v,{name:"user-check",class:"flex-shrink-0 h-3 fill-gray-400 pr-1"}),f(" "+o(e.assigned_to),1)])):m("",!0)])]),_:2},1032,["href"])]),t("td",ge,[d(p,{class:"flex items-center px-6 py-4 focus:text-indigo-500",href:s.route("tickets.edit",e.uid||e.id)},{default:u(()=>[f(o(e.priority),1)]),_:2},1032,["href"])]),t("td",ve,[d(p,{class:"flex items-center px-6 py-4 focus:text-indigo-500",href:s.route("tickets.edit",e.uid||e.id)},{default:u(()=>[f(o(e.status),1)]),_:2},1032,["href"])]),t("td",be,[d(p,{class:"flex items-center px-6 py-4 focus:text-indigo-500",href:s.route("tickets.edit",e.uid||e.id)},{default:u(()=>[f(o(s.$t("error")==="error"?s.moment(e.created_at).fromNow():s.moment(e.created_at).locale("zh-tw").fromNow()),1)]),_:2},1032,["href"])]),t("td",ke,[d(p,{class:"flex items-center px-6 py-4 focus:text-indigo-500",href:s.route("tickets.edit",e.uid||e.id)},{default:u(()=>[f(o(s.$t("error")==="error"?s.moment(e.updated_at).fromNow():s.moment(e.updated_at).locale("zh-tw").fromNow()),1)]),_:2},1032,["href"])])]))),128)),a.tickets.data.length===0?(i(),n("tr",we,[t("td",xe,o(s.$t("No ticket found.")),1)])):m("",!0)])])]),d(S,{class:"mt-4",links:a.tickets.links},null,8,["links"])])}const Pe=R(G,[["render",Ve]]);export{Pe as default};
