import{I as w,h as b}from"./moment-BbZOc2s_.js";import{S as k,t as M,p as C}from"./SearchInput-Btdhsrxv.js";import{L}from"./Layout-CCj0oP25.js";import{m as j}from"./mapValues-BTwQdjL6.js";import{P as I}from"./Pagination-CmEu2SMB.js";import{i as T,Z as V,k as H,r as h,c as r,a as u,b as e,t as i,F as f,j as m,h as c,o as l,g as B,w as E,n as N}from"./app-a1pcr069.js";import{_ as U,C as A,B as S,E as D,I as O,M as P,P as R,U as F,H as Q,a as z,L as Z,b as q,T as G,c as J,d as K,e as W,f as X,g as Y}from"./UploadAdapter-IKL1r5hU.js";import{_ as $}from"./FlashMessages-CFOcLP80.js";const ee={metaInfo:{title:"Chat"},components:{SearchInput:k,Icon:w,Pagination:I,Link:T,Head:V,Ckeditor:U},layout:L,props:{filters:Object,conversations:Object,chat:Object,title:String},remember:"form",data(){return{message:"",user:this.$page.props.auth.user,user_access:this.$page.props.auth.user.access,form:{search:this.filters.search},editor:A,editorConfig:{plugins:[S,D,O,P,R,F,Q,z,Z,q,G,J,K,W,X],toolbar:["heading","|","bold","italic","link","bulletedList","numberedList","|","outdent","indent","|","insertTable","blockQuote","|","imageUpload","mediaEmbed","|","undo","redo"],table:{toolbar:["tableColumn","tableRow","mergeTableCells"]},extraPlugins:[function(o){o.plugins.get("FileRepository").createUploadAdapter=a=>new Y(a)}]}}},watch:{form:{deep:!0,handler:M(function(){this.$inertia.get(this.route("chat"),C(this.form),{preserveState:!0})},150)}},methods:{textOnly(s){return s.replace(/(<([^>]+)>)/ig,"")},reset(){this.form=j(this.form,()=>null)},sendMessage(){var s=this;const o={message:this.message,user_id:this.user.id,_token:this.$page.props.csrf_token,conversation_id:this.chat.id};this.message="",H.post(this.route("chat.message"),o).then(a=>{a.data&&s.chat.messages.push(a.data),this.$emit("message sent!")}).catch(a=>{console.log(a)})},navigateTo(s){window.location.href=this.route("chat.current",s)},destroy(s){let o=this;confirm("Are you sure you want to delete this conversation?")&&this.$inertia.delete(this.route("chat.destroy",s),{onSuccess:()=>{setTimeout(function(){o.reset()},4e3)}})},restore(s){confirm("Are you sure you want to restore this conversation?")&&this.$inertia.put(this.route("chat.restore",s))},pushMessage(s){let o=this.conversations.data.find(a=>a.id===s.conversation_id);typeof o=="object"?(o.title=s.message,o.total_entry=o.total_entry+1,this.chat&&this.chat.id===s.conversation_id&&(this.chat.messages.push(s),o.total_entry=0)):this.conversations.data.unshift({id:s.conversation_id,total_entry:1,title:s.message,creator:s.creator,updated_at:s.updated_at})}},created(){this.moment=b;let s=this;window.Echo&&window.Echo.private("messages").listen("NewChatMessage",function(o){typeof o.chatMessage=="object"&&s.pushMessage(o.chatMessage)})}},te={class:"main flex-1 flex flex-col sec_chat"},se={class:"flex-1 flex h-full gap-5"},ae={class:"sidebar h-full hidden lg:flex w-1/3 flex-2 flex-col bg-white"},oe={class:"chat-box h-full"},ie={class:"chat-left-aside h-full"},le={class:"c-top"},re={class:"media mb-1"},ne=["src"],ce={key:1,src:"/images/svg/profile.svg",alt:"",class:"rounded-circle rounded-full user-image"},de={class:"about"},he={class:"name f-w-600"},ue={class:"status"},_e={class:"search flex-2 py-2"},fe={class:"c-list"},me={class:"flex-1 h-full overflow-hidden overflow-y-auto pt-2"},ge={class:"flex-2"},ve={class:"w-12 h-12 relative"},xe={class:"w-12 h-12 rounded-full mx-auto user_icon",alt:"chat-user"},ye={class:"flex-1 px-2"},pe={class:"truncate w-32"},we={class:""},be={key:0,class:"mt-1"},ke={class:"text-gray-600"},Me={key:1,class:"mt-1 truncate w-32"},Ce={class:"text-gray-600 text-xs"},Le={class:"flex-2 text-right"},je={class:"text-gray-500"},Ie={key:0,class:"text-xs bg-red-500 text-white rounded-full h-6 w-6 leading-6 text-center inline-block"},Te={key:0,class:"flex w-full h-full justify-center items-center text-gray-500"},Ve={class:"chat-area h-full w-2/3 flex-1 flex flex-col bg-white"},He={class:"flex-3"},Be={key:0,class:"chat-header flex pb-3 justify-between"},Ee={class:"flex"},Ne={class:"w-12 h-12 relative mr-3"},Ue={class:"w-12 h-12 rounded-full mx-auto user_icon",title:"{{ chat.creator.first_name }} {{ chat.creator.last_name }}"},Ae={class:"flex flex-col pt-1"},Se={class:"name"},De={class:"status digits pt-2"},Oe={class:"messages flex-1 overflow-auto reverse__order"},Pe={key:0,class:"flex-2"},Re={class:"w-12 h-12 relative"},Fe={class:"w-12 h-12 rounded-full mx-auto user_icon"},Qe={key:1,class:"flex-1 px-2 mt__wrap"},ze=["innerHTML"],Ze={class:"pl-4"},qe={class:"text-gray-500"},Ge={key:2,class:"flex-1 px-2 text-right mt__wrap"},Je=["innerHTML"],Ke={class:"pr-4"},We={class:"text-gray-500"},Xe={key:1,class:"flex w-full h-full justify-center items-center text-gray-500"},Ye={key:2,class:"flex w-full h-full justify-center items-center text-gray-500"},$e={key:0,class:"flex-2 pt-4 pb-3"},et={class:"write bg-white shadow flex rounded-lg"},tt={class:"flex-1 ticket_comment_edit"},st={class:"flex-2 w-35 p-2 flex content-center items-center"},at={class:"flex-1"};function ot(s,o,a,it,n,d){const g=h("Head"),v=h("search-input"),x=h("Link"),_=h("icon"),y=h("ckeditor");return l(),r("div",null,[u(g,{title:s.$t(a.title)},null,8,["title"]),e("div",te,[e("div",se,[e("div",ae,[e("div",oe,[e("div",ie,[e("div",le,[e("div",re,[n.user.photo?(l(),r("img",{key:0,src:n.user.photo,alt:"",class:"rounded-circle rounded-full user-image"},null,8,ne)):(l(),r("img",ce)),e("div",de,[e("div",he,i(n.user.first_name)+" "+i(n.user.last_name),1),e("div",ue,i(s.$t(n.user.role.name)),1)])]),e("div",_e,[u(v,{modelValue:n.form.search,"onUpdate:modelValue":o[0]||(o[0]=t=>n.form.search=t),class:"w-full",onReset:d.reset},null,8,["modelValue","onReset"])])]),e("div",fe,[e("div",me,[(l(!0),r(f,null,m(a.conversations.data,t=>(l(),B(x,{key:t.id,href:s.route("chat.current",t.slug||t.id),class:N(["entry cursor-pointer transform hover:scale-105 duration-300 transition-transform mb-4 rounded p-4 mx-5 flex shadow-md",{"border-l-4 border-red-500":a.chat&&t.id===a.chat.id}])},{default:E(()=>[e("div",ge,[e("div",ve,[e("span",xe,i(Array.from(t.creator.first_name)[0]),1)])]),e("div",ye,[e("div",pe,[e("span",we,i(t.creator.first_name)+" "+i(t.creator.last_name),1)]),t.creator.email?(l(),r("div",be,[e("small",ke,i(t.creator.email),1)])):c("",!0),t.title?(l(),r("div",Me,[e("small",Ce,i(d.textOnly(t.title)),1)])):c("",!0)]),e("div",Le,[e("div",null,[e("small",je,i(s.moment(t.updated_at).format("DD MMM")),1)]),e("div",null,[t.total_entry?(l(),r("small",Ie,i(t.total_entry),1)):c("",!0)])])]),_:2},1032,["href","class"]))),128)),a.conversations.data.length?c("",!0):(l(),r("div",Te,i(s.$t("No conversation found.")),1))])])])])]),e("div",Ve,[e("div",He,[a.chat?(l(),r("div",Be,[e("div",Ee,[e("div",Ne,[e("span",Ue,i(Array.from(a.chat.creator.first_name)[0]),1)]),e("div",Ae,[e("div",Se,i(a.chat.creator.first_name)+" "+i(a.chat.creator.last_name),1),e("div",De,i(a.chat.creator.email),1)])]),n.user_access.chat.delete?(l(),r("div",{key:0,class:"flex justify-center mr-3 items-center cursor-pointer",onClick:o[1]||(o[1]=t=>d.destroy(a.chat.id))},[u(_,{name:"trash",class:"w-5 h-5"})])):c("",!0)])):c("",!0)]),e("div",Oe,[a.chat&&a.chat.messages.length?(l(!0),r(f,{key:0},m(a.chat.messages.slice().reverse(),(t,p)=>(l(),r("div",{key:p,class:"message mb-4 flex"},[!t.user_id&&t.contact&&t.contact.first_name?(l(),r("div",Pe,[e("div",Re,[e("span",Fe,i(Array.from(t.contact.first_name)[0]),1)])])):c("",!0),t.user_id?c("",!0):(l(),r("div",Qe,[e("div",{class:"inline-block bg-gray-300 rounded p-2 px-3 text-gray-700 leading-5 ckc",innerHTML:t.message},null,8,ze),e("div",Ze,[e("small",qe,i(s.moment(t.updated_at).fromNow(!0)),1)])])),t.user_id?(l(),r("div",Ge,[e("div",{class:"inline-block bg-blue-600 rounded p-2 px-3 text-white leading-5 ckc",innerHTML:t.message},null,8,Je),e("div",Ke,[e("small",We,i(s.moment(t.updated_at).fromNow(!0)),1)])])):c("",!0)]))),128)):a.chat&&!a.chat.messages.length?(l(),r("div",Xe,i(s.$t("No history found for this conversation")),1)):(l(),r("div",Ye,i(s.$t("Click on a conversation from left to see the histories.")),1))]),a.chat?(l(),r("div",$e,[e("div",et,[e("div",tt,[u(y,{id:"ticketDiscussion",editor:n.editor,modelValue:n.message,"onUpdate:modelValue":o[2]||(o[2]=t=>n.message=t),name:"comment",config:n.editorConfig,autofocus:""},null,8,["editor","modelValue","config"])]),e("div",st,[e("div",at,[e("button",{class:"bg-blue-400 w-10 h-10 rounded-full flex justify-center items-center",onClick:o[3]||(o[3]=(...t)=>d.sendMessage&&d.sendMessage(...t))},[u(_,{class:"w-4 h-4 fill-gray-100",name:"send"})])])])])])):c("",!0)])])])])}const ft=$(ee,[["render",ot]]);export{ft as default};
