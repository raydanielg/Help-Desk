import{i as S,k as x,r as g,c as n,b as i,d as B,g as m,h as d,w as _,F as f,j as p,a as y,e as h,t as u,o as s,f as V,W as T,y as j}from"./app-a1pcr069.js";import{I as E}from"./moment-BbZOc2s_.js";import{L as F}from"./Layout-CCj0oP25.js";import{T as L}from"./TextInput-BV_CAnm2.js";import{S as M}from"./SelectInput-LDo5GZlZ.js";import{S as A}from"./SelectInputFilter-fntCZT8t.js";import{T as D}from"./TextareaInput-CORLWzzy.js";import{L as R}from"./LoadingButton-D7uFng42.js";import{_ as q,C as P,B as N,E as z,I as O,M as G,P as H,U as Q,H as W,a as J,L as K,b as X,T as Y,c as Z,d as $,e as ee,f as te,g as le}from"./UploadAdapter-IKL1r5hU.js";import{_ as re}from"./FlashMessages-CFOcLP80.js";import"./v4-SoommWqA.js";const se={metaInfo:{title:"Create Ticket"},components:{LoadingButton:R,SelectInput:M,SelectInputFilter:A,TextInput:L,TextareaInput:D,Link:S,Icon:E,Ckeditor:q},layout:F,props:{customers:Array,usersExceptCustomers:Array,priorities:Array,statuses:Array,types:Array,departments:Array,all_categories:Array,auth:Object,hidden_fields:Object,custom_fields:Object},remember:!1,data(){return{user_access:this.$page.props.auth.user.access,editor:P,editorConfig:{plugins:[N,z,O,G,H,Q,W,J,K,X,Y,Z,$,ee,te],toolbar:["heading","|","bold","italic","link","bulletedList","numberedList","|","outdent","indent","|","insertTable","blockQuote","|","imageUpload","mediaEmbed","|","undo","redo"],table:{toolbar:["tableColumn","tableRow","mergeTableCells"]},extraPlugins:[function(t){t.plugins.get("FileRepository").createUploadAdapter=o=>new le(o)}]},categories:[],sub_categories:[],form:this.$inertia.form({user_id:null,priority_id:null,status_id:null,department_id:null,category_id:null,sub_category_id:null,assigned_to:null,type_id:null,subject:null,details:"",files:[],custom_field:{}})}},created(){console.log(this.custom_fields),this.setDefaultValue(this.statuses,"status_id","Pending"),this.setDefaultValue(this.priorities,"priority_id","Generally")},methods:{getCategories(){this.categories=this.all_categories.filter(r=>r.department_id===this.form.department_id),this.form.category_id=null,this.$refs.category.selected=null},getSubCategories(){this.sub_categories=this.all_categories.filter(r=>r.parent_id===this.form.category_id),this.form.sub_category_id=null,this.$refs.sub_category.selected=null},doFilter(r){x.get(this.route("filter.customers",{search:r.target.value})).then(t=>{this.customers.splice(0,this.customers.length,...t.data)})},doFilterUsersExceptCustomer(r){x.get(this.route("filter.users_except_customer",{search:r.target.value})).then(t=>{this.usersExceptCustomers.splice(0,this.usersExceptCustomers.length,...t.data)})},setDefaultValue(r,t,o){const v=r.find(l=>l.name.match(new RegExp(o+".*")));v&&(this.form[t]=v.id)},fileInputChange(r){let t=r.target.files;for(let o=0;o<t.length;o++)this.form.files.push(t[o])},fileRemove(r,t){this.form.files.splice(t,1)},getFileSize(r){const t=Math.floor(Math.log(r)/Math.log(1024));return(r/Math.pow(1024,t)).toFixed(2)*1+" "+["B","kB","MB","GB","TB"][t]},fileBrowse(){this.$refs.file.click()},store(){this.form.user_id=this.auth.user.id,this.form.post(this.route("tickets.store"))}}},oe={class:"bg-white rounded-md shadow overflow-hidden max-w-full"},ie={class:"p-8 -mr-6 -mb-8 flex flex-wrap"},ne=["value"],ue=["value"],ae={value:null},de=["value"],me={value:null},fe=["value"],pe={value:null},ce=["value"],ge={class:"flex flex-col w-full"},_e=["for"],be={key:0,class:"pl-2 text-xs"},ye=["onUpdate:modelValue","type","id","placeholder","required"],he=["id","onUpdate:modelValue","placeholder"],ve={key:2,class:"mt-1 text-sm text-gray-500 dark:text-gray-300"},we={class:"pr-6 pb-8 w-full"},xe={class:"pr-6 pb-8 w-full lg:w-full flex-col"},Ve={class:"flex-1 pr-1"},Ce={class:"text-gray-500 text-xs"},ke=["onClick"],Ue={class:"px-8 py-4 bg-gray-50 border-t border-gray-100 flex justify-end items-center"};function Ie(r,t,o,v,l,a){const w=g("select-input-filter"),b=g("select-input"),C=g("text-input"),k=g("ckeditor"),U=g("icon"),I=g("loading-button");return s(),n("div",null,[i("div",oe,[i("form",{onSubmit:t[13]||(t[13]=B((...e)=>a.store&&a.store(...e),["prevent"]))},[i("div",ie,[l.user_access.ticket.update&&o.auth.user.role.slug!=="customer"?(s(),m(w,{key:0,placeholder:"Start typing",onInput:a.doFilter,items:o.customers,modelValue:l.form.user_id,"onUpdate:modelValue":t[0]||(t[0]=e=>l.form.user_id=e),error:l.form.errors.user_id,class:"pr-6 pb-8 w-full lg:w-1/3",label:r.$t("Customer")},null,8,["onInput","items","modelValue","error","label"])):d("",!0),l.user_access.ticket.update?(s(),m(b,{key:1,modelValue:l.form.priority_id,"onUpdate:modelValue":t[1]||(t[1]=e=>l.form.priority_id=e),error:l.form.errors.priority_id,class:"pr-6 pb-8 w-full lg:w-1/3",label:r.$t("Priority")},{default:_(()=>[t[14]||(t[14]=i("option",{value:null},null,-1)),(s(!0),n(f,null,p(o.priorities,e=>(s(),n("option",{key:e.id,value:e.id},u(e.name),9,ne))),128))]),_:1},8,["modelValue","error","label"])):d("",!0),o.hidden_fields&&o.hidden_fields.includes("ticket_type")?d("",!0):(s(),m(b,{key:2,modelValue:l.form.type_id,"onUpdate:modelValue":t[2]||(t[2]=e=>l.form.type_id=e),error:l.form.errors.type_id,class:"pr-6 pb-8 w-full lg:w-1/3",label:r.$t("Ticket Type")},{default:_(()=>[t[15]||(t[15]=i("option",{value:null},null,-1)),(s(!0),n(f,null,p(o.types,e=>(s(),n("option",{key:e.id,value:e.id},u(e.name),9,ue))),128))]),_:1},8,["modelValue","error","label"])),o.hidden_fields&&o.hidden_fields.includes("department")?d("",!0):(s(),m(b,{key:3,onChange:t[3]||(t[3]=e=>a.getCategories()),modelValue:l.form.department_id,"onUpdate:modelValue":t[4]||(t[4]=e=>l.form.department_id=e),error:l.form.errors.department_id,class:"pr-6 pb-5 md:col-span-6 lg:w-1/3",label:r.$t("Department")},{default:_(()=>[i("option",ae,u(r.$t("Select a department")),1),(s(!0),n(f,null,p(o.departments,e=>(s(),n("option",{key:e.id,value:e.id},u(e.name),9,de))),128))]),_:1},8,["modelValue","error","label"])),!(o.hidden_fields&&o.hidden_fields.includes("category"))&&l.form.department_id?(s(),m(b,{key:4,ref:"category",onChange:t[5]||(t[5]=e=>a.getSubCategories()),modelValue:l.form.category_id,"onUpdate:modelValue":t[6]||(t[6]=e=>l.form.category_id=e),error:l.form.errors.category_id,class:"pb-5 pr-6 md:col-span-6 lg:w-1/3",label:r.$t("Category")},{default:_(()=>[i("option",me,u(r.$t("Select a category")),1),(s(!0),n(f,null,p(l.categories,e=>(s(),n("option",{key:e.id,value:e.id},u(e.name),9,fe))),128))]),_:1},8,["modelValue","error","label"])):d("",!0),l.form.category_id?(s(),m(b,{key:5,ref:"sub_category",modelValue:l.form.sub_category_id,"onUpdate:modelValue":t[7]||(t[7]=e=>l.form.sub_category_id=e),error:l.form.errors.sub_category_id,class:"pb-5 md:col-span-6 lg:w-1/3",label:r.$t("Sub Category")},{default:_(()=>[i("option",pe,u(r.$t("Select a sub category")),1),(s(!0),n(f,null,p(l.sub_categories,e=>(s(),n("option",{key:e.id,value:e.id},u(e.name),9,ce))),128))]),_:1},8,["modelValue","error","label"])):d("",!0),o.auth.user.role.slug!=="customer"&&l.user_access.ticket.update&&!(o.hidden_fields&&o.hidden_fields.includes("assigned_to"))?(s(),m(w,{key:6,placeholder:"Start typing",onInput:a.doFilterUsersExceptCustomer,items:o.usersExceptCustomers,modelValue:l.form.assigned_to,"onUpdate:modelValue":t[8]||(t[8]=e=>l.form.assigned_to=e),error:l.form.errors.assigned_to,class:"pr-6 pb-8 w-full lg:w-1/3",label:r.$t("Assigned to")},null,8,["onInput","items","modelValue","error","label"])):d("",!0),(s(!0),n(f,null,p(o.custom_fields,e=>(s(),n("div",{class:"pr-6 pb-8 w-full lg:w-1/3",key:e.id},[i("div",ge,[i("label",{for:["checkbox"].includes(e.type)?null:"ticket_field_"+e.id,class:"form-label"},[h(u(e.label)+" ",1),e.required?d("",!0):(s(),n("small",be,"(optional)"))],8,_e),["text","email","number"].includes(e.type)?V((s(),n("input",{key:0,"onUpdate:modelValue":c=>l.form.custom_field[e.name]=c,type:e.type,id:"ticket_field_"+e.id,placeholder:e.placeholder,required:e.required,class:"form-input"},null,8,ye)),[[T,l.form.custom_field[e.name]]]):d("",!0),e.type==="textarea"?V((s(),n("textarea",{key:1,id:"ticket_field_"+e.id,rows:"2","onUpdate:modelValue":c=>l.form.custom_field[e.name]=c,class:"form-textarea",placeholder:e.placeholder},null,8,he)),[[j,l.form.custom_field[e.name]]]):d("",!0),e.hint?(s(),n("p",ve,u(e.hint),1)):d("",!0)])]))),128)),y(C,{modelValue:l.form.subject,"onUpdate:modelValue":t[9]||(t[9]=e=>l.form.subject=e),error:l.form.errors.subject,class:"pr-6 pb-8 w-full lg:w-full",label:r.$t("Subject")},null,8,["modelValue","error","label"]),i("div",we,[t[16]||(t[16]=i("label",{class:"form-label"},"Request Details:",-1)),y(k,{id:"ticketDetails",editor:l.editor,modelValue:l.form.details,"onUpdate:modelValue":t[10]||(t[10]=e=>l.form.details=e),config:l.editorConfig},null,8,["editor","modelValue","config"])]),i("input",{ref:"file",type:"file",accept:".xlsx,.xls,image/*,.doc, .docx,.ppt, .pptx,.txt,.pdf, .zip",class:"hidden",multiple:"multiple",onChange:t[11]||(t[11]=(...e)=>a.fileInputChange&&a.fileInputChange(...e))},null,544),i("div",xe,[i("button",{type:"button",class:"btn flex justify-center items-center",onClick:t[12]||(t[12]=(...e)=>a.fileBrowse&&a.fileBrowse(...e))},[y(U,{name:"file",class:"flex-shrink-0 h-8 fill-gray-400 pr-1"}),t[17]||(t[17]=h()),i("h4",null,u(r.$t("Attach files")),1)]),l.form.files.length?(s(!0),n(f,{key:0},p(l.form.files,(e,c)=>(s(),n("div",{class:"flex items-center justify-between pr-6 pt-8 w-full lg:w-1/2",key:c},[i("div",Ve,[h(u(e.name)+" ",1),i("span",Ce,"("+u(a.getFileSize(e.size))+")",1)]),i("button",{type:"button",class:"btn flex justify-center items-center",onClick:Se=>a.fileRemove(e,c)},u(r.$t("Remove")),9,ke)]))),128)):d("",!0)])]),i("div",Ue,[y(I,{loading:l.form.processing,class:"btn-indigo",type:"submit"},{default:_(()=>[h(u(r.$t("Create"))+" "+u(r.$t("Ticket")),1)]),_:1},8,["loading"])])],32)])])}const Pe=re(se,[["render",Ie]]);export{Pe as default};
